1. Структура языка SQL

Язык SQL разделен на функциональные группы команд. Для анализа данных и выполнения выборок ключевым является блок DML.
Группа	Описание	Основные команды
DML	Манипуляция данными (основной блок для аналитика)	SELECT, INSERT, UPDATE, DELETE
DDL	Определение структуры таблиц и схем	CREATE, ALTER, DROP, TRUNCATE
DCL/TCL	Управление доступом и транзакциями	GRANT, COMMIT, ROLLBACK
2. Логический порядок выполнения SELECT

Для корректного построения сложных запросов необходимо соблюдать последовательность, в которой СУБД обрабатывает данные:

    FROM (+ JOIN) — Выбор источника (таблицы).

    WHERE — Фильтрация исходных строк.

    GROUP BY — Группировка данных.

    HAVING — Фильтрация уже сгруппированных данных.

    SELECT — Проекция колонок и расчет выражений.

    ORDER BY — Финальная сортировка.

3. Фильтрация и условия (WHERE)

Используется для ограничения набора данных до того, как начнется их обработка.

    Работа с NULL: Значение NULL — это отсутствие данных. Оно проверяется только через IS NULL или IS NOT NULL.

    Оператор LIKE: * % — любое кол-во символов (напр. '%иван%' найдет и "Иванов", и "Диван").

        _ — ровно один символ.

    Диапазоны и списки:

        BETWEEN X AND Y — включает обе границы.

        IN (v1, v2) — заменяет цепочку условий OR.

4. Агрегация данных (GROUP BY & HAVING)

Агрегатные функции (SUM, AVG, COUNT, MIN, MAX) сворачивают группу строк в одну строку.

    Правило: Любая колонка в SELECT, не обернутая в агрегатную функцию, обязательно должна присутствовать в блоке GROUP BY.

    WHERE фильтрует строки (до группировки).

    HAVING фильтрует группы (после группировки).

5. Оконные функции (Window Functions)

Позволяют выполнять вычисления вдоль набора строк, связанных с текущей строкой, не скрывая детализацию (строки не схлопываются).

Синтаксис: ФУНКЦИЯ() OVER (PARTITION BY [Группировка] ORDER BY [Сортировка])

    PARTITION BY: Определяет границы «окна» (например, расчет внутри каждого отдела отдельно).

    ORDER BY: Определяет последовательность внутри окна (важно для ранжирования).

6. Практические шаблоны запросов
Фильтрация и сортировка
SQL

SELECT Name, ListPrice
FROM Production.Product
WHERE ListPrice > 1000 AND Color IN ('Black', 'Silver')
ORDER BY ListPrice DESC;

Агрегация по категориям
SQL

SELECT Color, COUNT(*) AS Qty, AVG(ListPrice) AS AvgPrice
FROM Production.Product
WHERE Color IS NOT NULL
GROUP BY Color
HAVING COUNT(*) > 5;

Аналитическое окно (Доля от общего)
SQL

SELECT 
    Name, 
    SalesYTD,
    SUM(SalesYTD) OVER() AS TotalSales,
    (SalesYTD / SUM(SalesYTD) OVER()) * 100 AS PercentOfTotal
FROM Sales.SalesTerritory;